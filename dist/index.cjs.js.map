{"version":3,"file":"index.cjs.js","sources":["../src/components/ImageWithColorSwap/ImageWithColorSwap.tsx"],"sourcesContent":["import React from \"react\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\n\r\ninterface ImageWithColorSwapProps {\r\n  src: string;\r\n  fromColor: string;\r\n  toColor: string;\r\n  threshold?: number;\r\n  alt?: string;\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n  loadingElement?: React.ReactNode;\r\n}\r\n\r\ntype RGB = [number, number, number];\r\n\r\nconst ImageWithColorSwap: React.FC<ImageWithColorSwapProps> = ({ \r\n  src, \r\n  fromColor, \r\n  toColor, \r\n  threshold = 60, \r\n  alt = \"Processed image\",\r\n  className,\r\n  style,\r\n  loadingElement = <p>...</p>\r\n}) => {\r\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\r\n  const [processedSrc, setProcessedSrc] = useState<string | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  const hexToRgb = (hex: string): RGB => {\r\n    const cleanHex = hex.replace(\"#\", \"\");\r\n    return [parseInt(cleanHex.substr(0, 2), 16), parseInt(cleanHex.substr(2, 2), 16), parseInt(cleanHex.substr(4, 2), 16)];\r\n  };\r\n\r\n  const [fromColorRGB, toColorRGB]: [RGB, RGB] = [hexToRgb(fromColor), hexToRgb(toColor)];\r\n\r\n  useEffect(() => {\r\n    if (!src) return;\r\n\r\n    setIsLoading(true);\r\n    const image = new Image();\r\n    image.crossOrigin = \"Anonymous\";\r\n    image.src = src;\r\n\r\n    image.onload = () => {\r\n      const canvas = canvasRef.current;\r\n      if (!canvas) return;\r\n\r\n      const ctx = canvas.getContext(\"2d\");\r\n      if (!ctx) return;\r\n\r\n      canvas.width = image.width;\r\n      canvas.height = image.height;\r\n      ctx.drawImage(image, 0, 0);\r\n\r\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n      const data = imageData.data;\r\n\r\n      const isMatchingColor = (r: number, g: number, b: number): boolean => {\r\n        const [targetR, targetG, targetB] = fromColorRGB;\r\n        const distance = Math.sqrt(Math.pow(r - targetR, 2) + Math.pow(g - targetG, 2) + Math.pow(b - targetB, 2));\r\n        return distance < (threshold * 441.67) / 100;\r\n      };\r\n\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        const r = data[i];\r\n        const g = data[i + 1];\r\n        const b = data[i + 2];\r\n\r\n        if (isMatchingColor(r, g, b)) {\r\n          data[i] = toColorRGB[0];\r\n          data[i + 1] = toColorRGB[1];\r\n          data[i + 2] = toColorRGB[2];\r\n        }\r\n      }\r\n\r\n      ctx.putImageData(imageData, 0, 0);\r\n      setProcessedSrc(canvas.toDataURL());\r\n      setIsLoading(false);\r\n    };\r\n\r\n    image.onerror = () => {\r\n      console.error(\"Error loading image\");\r\n      setIsLoading(false);\r\n    };\r\n\r\n    return () => {\r\n      image.onload = null;\r\n      image.onerror = null;\r\n    };\r\n  }, [src, fromColorRGB, toColorRGB, threshold]);\r\n\r\n  return (\r\n    <>\r\n      <canvas ref={canvasRef} style={{ display: \"none\" }} />\r\n      {isLoading ? loadingElement : processedSrc && (\r\n        <img \r\n          src={processedSrc} \r\n          alt={alt}\r\n          className={className}\r\n          style={style}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ImageWithColorSwap;\r\n"],"names":["useRef","useState","useEffect"],"mappings":"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"}